# Spring Cloud底层原理
### 概述
SpringClound是一个全家桶式的技术栈，包含了很多组件。本文先从其最核心的几个组件入手，来剖析一下其底层的工作原理。也就是Eureka、Ribbon、Feign、
Hystrix、Zuul这几个组件。  
### 一、业务场景介绍  
先来给大家说一个业务场景，假设咱们现在开发一个电商网站，要实现支付订单的功能，流程如下：
* 创建一个订单之后，如果用户立刻支付了这个订单，我们需要将订单的状态更新为“已支付”
* 扣减相应的商品库存
* 通知仓库中心，进行发货  
* 给用户的这次购物增减相应的积分  


针对上述流程，我们需要有订单服务、库存服务、仓储服务、积分服务。整个流程的大体思路如下：  


* 用户针对一个订单完成支付之后，就会去找订单服务，更新订单状态  
* 订单服务调用库存服务，完成相应功能  
* 订单服务调用仓储服务，完成相应功能  
* 订单服务调用积分服务，完成相应功能  

至此，整个支付订单的业务流程结束,下图这张图，清晰表明了各服务间的调用过程：     
![image](https://github.com/bertcodes/ability/blob/master/springcloud/image/springcloud-theory-1th.png)  

好！有了业务场景之后，咱们就一起来看看Spring Cloud微服务架构中，这几个组件如何相互协作，各自发挥的作用以及其背后的原理。

### 二、Spring Cloud核心组件：Eureka
咱们来考虑第一个问题：订单服务想要调用库存服务、仓储服务，或者是积分服务，怎么调用？  
* 订单服务压根儿就不知道人家库存服务在哪台机器上啊！他就算想要发起一个请求，都不知道发送给谁，有心无力！  
* 这时候，就轮到Spring Cloud Eureka出场了。Eureka是微服务架构中的注册中心，专门负责服务的注册与发现。  

 咱们来看看下面的这张图，结合图来仔细剖析一下整个流程： 

![image](https://github.com/bertcodes/ability/blob/master/springcloud/image/springcloud-theory-2th.png)    

如上图所示，库存服务、仓储服务、积分服务中都有一个Eureka Client组件，这个组件专门负责将这个服务的信息注册到Eureka Server中。说白了，就是告诉Eureka Server，自己在哪台机器上，监听着哪个端口。而Eureka Server是一个注册中心，里面有一个注册表，保存了各服务所在的机器和端口号

订单服务里也有一个Eureka Client组件，这个Eureka Client组件会找Eureka Server问一下：库存服务在哪台机器啊？监听着哪个端口啊？仓储服务呢？积分服务呢？然后就可以把这些相关信息从Eureka Server的注册表中拉取到自己本地缓存起来。

这时如果订单服务想要调用库存服务，不就可以找自己本地的Eureka Client问一下库存服务在哪台机器？监听哪个端口吗？收到响应后，紧接着就可以发送一个请求过去，调用库存服务扣减库存的那个接口！同理，如果订单服务要调用仓储服务、积分服务，也是如法炮制。

总结一下：  
* Eureka Client:负责将这个服务的信息注册到Eureka Server中  
* Eureka Server:注册中心，里面有一个注册表，保存了各个服务所在的机器和端口号  



